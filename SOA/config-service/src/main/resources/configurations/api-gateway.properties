# =====================================================
# APPLICATION
# =====================================================
spring.application.name=api-gateway
server.port=8080

# =====================================================
# EUREKA CLIENT
# =====================================================
eureka.client.enabled=true
eureka.client.service-url.defaultZone=http://${EUREKA_HOST:localhost}:8761/eureka/
eureka.instance.prefer-ip-address=true

# ‚ùå T·∫ÆT discovery locator (tr√°nh ƒë√® route & l·ªói token)
spring.cloud.gateway.discovery.locator.enabled=false

# =====================================================
# üî• GI·ªÆ NGUY√äN HOST & HEADER (JWT)
# =====================================================
spring.cloud.gateway.default-filters[0]=PreserveHostHeader

# =====================================================
# ROUTE DEFINITIONS
# =====================================================

# ---------- USER SERVICE ----------
spring.cloud.gateway.routes[0].id=user-service
spring.cloud.gateway.routes[0].uri=lb://user-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/v1/auth/**,/api/v1/users/**

# ---------- COURSE SERVICE (API) ----------
spring.cloud.gateway.routes[1].id=course-service-api
spring.cloud.gateway.routes[1].uri=lb://course-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/v1/courses/**,/api/v1/banners/**,/api/v1/videos/**,/api/v1/exercises/**

# ---------- üî• HLS STATIC (KH√îNG LOAD BALANCER) ----------
spring.cloud.gateway.routes[2].id=course-service-hls
spring.cloud.gateway.routes[2].uri=http://localhost:8082
spring.cloud.gateway.routes[2].predicates[0]=Path=/hls/**
spring.cloud.gateway.routes[2].filters[0]=StripPrefix=0

# ---------- IMAGES STATIC ----------
spring.cloud.gateway.routes[3].id=course-service-images
spring.cloud.gateway.routes[3].uri=http://localhost:8082
spring.cloud.gateway.routes[3].predicates[0]=Path=/images/**
spring.cloud.gateway.routes[3].filters[0]=StripPrefix=0

# ---------- EXERCISES FILE ----------
spring.cloud.gateway.routes[4].id=course-service-exercises
spring.cloud.gateway.routes[4].uri=http://localhost:8082
spring.cloud.gateway.routes[4].predicates[0]=Path=/exercises/**
spring.cloud.gateway.routes[4].filters[0]=StripPrefix=0

# ---------- PAYMENT SERVICE ----------
spring.cloud.gateway.routes[5].id=payment-service
spring.cloud.gateway.routes[5].uri=lb://payment-service
spring.cloud.gateway.routes[5].predicates[0]=Path=/api/v1/payments/**,/api/v1/wallet/**

# ---------- ENROLLMENT SERVICE ----------
spring.cloud.gateway.routes[6].id=enrollment-service
spring.cloud.gateway.routes[6].uri=lb://enrollment-service
spring.cloud.gateway.routes[6].predicates[0]=Path=/api/v1/enrollments/**

# ---------- NOTIFICATION SERVICE ----------
spring.cloud.gateway.routes[7].id=notification-service
spring.cloud.gateway.routes[7].uri=lb://notification-service
spring.cloud.gateway.routes[7].predicates[0]=Path=/api/v1/notifications/**,/ws/**

# =====================================================
# üåê GLOBAL CORS (CHO REACT)
# =====================================================
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOrigins=http://localhost:5173,http://localhost:3000
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS,PATCH
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=true
spring.cloud.gateway.globalcors.cors-configurations.[/**].maxAge=3600

# =====================================================
# LOGGING (DEBUG KHI C·∫¶N)
# =====================================================
logging.level.org.springframework.cloud.gateway=INFO
logging.level.reactor.netty.http.client=INFO
